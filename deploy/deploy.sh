#!/bin/bash
# =============================================
#  –°–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è ‚Äî –∑–∞–ø—É—Å–∫–∞—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏–ª–∏ —á–µ—Ä–µ–∑ SSH
#  
#  –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
#    ssh root@YOUR_IP "cd /opt/outreach && bash deploy/deploy.sh"
#  
#  –ò–ª–∏ –∏–∑ GitHub Actions / –ª–æ–∫–∞–ª—å–Ω–æ:
#    ssh root@YOUR_IP 'cd /opt/outreach && git pull && docker compose up -d --build'
# =============================================

set -e

PROJECT_DIR="/opt/outreach"
cd "$PROJECT_DIR"

echo ""
echo "========================================"
echo "  üöÄ Outreach ‚Äî –î–µ–ø–ª–æ–π"
echo "========================================"
echo ""

# 1. –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
echo "üì• –ü–æ–ª—É—á–∞—é –ø–æ—Å–ª–µ–¥–Ω–∏–π –∫–æ–¥..."
git pull origin master

# 2. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å
echo "üê≥ –ü–µ—Ä–µ—Å–æ–±–∏—Ä–∞—é –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã..."
docker compose up -d --build

# 3. –û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–∑—ã
echo "üßπ –ß–∏—â—É —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–∑—ã..."
docker image prune -f

# 4. –°—Ç–∞—Ç—É—Å
echo ""
echo "üìä –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:"
docker compose ps

echo ""
echo "========================================"
echo "  ‚úÖ –î–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à—ë–Ω!"
echo "========================================"
echo ""
